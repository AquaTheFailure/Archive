<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loading…</title>
  <meta name="description" content="Advanced single-file dark UI with version lock" />
  <style>
    :root{--bg:#0b0f14;--card:#0f1720;--muted:#9aa4b2;--accent:#39c0ff}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071018);font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#e6eef6}
    .center{height:100vh;display:flex;align-items:center;justify-content:center;animation:fadein 0.6s ease}
    @keyframes fadein{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:28px;border-radius:14px;max-width:820px;width:94%;box-shadow:0 6px 30px rgba(2,6,23,0.7)}
    h1{margin:0 0 8px;font-size:20px}
    p{margin:0 0 12px;color:var(--muted)}
    a.button{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:#021014;text-decoration:none;font-weight:600;transition:background 0.2s ease}
    a.button:hover{background:#66d2ff}
    code{background:rgba(255,255,255,0.02);padding:6px;border-radius:6px}
    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div id="screen" class="center">
    <div class="card" id="bootCard">
      <h1 id="bootTitle">Checking version…</h1>
      <p id="bootMsg">Connecting to update server. This site will only activate if it is the latest version.</p>
      <div id="bootActions" style="margin-top:14px"></div>
      <footer>Advanced UI — version-locked. (Static site friendly)</footer>
    </div>
  </div>

  <script>
  // ================= CONFIG =================
  const CURRENT_VERSION = '1.0.0';
  const VERSION_JSON_URL = 'https://github.com/AquaTheFailure/We-re-Not-Horses-We-re-Humans-and-Humans-are.../raw/refs/heads/main/version.json';
  // Example version.json: { "latestVersion": "1.2.0", "downloadURL": "https://github.com/USER/REPO/releases/latest/download/site.html" }
  // ==========================================

  function compareVersions(a,b){
    const pa=a.split('.').map(Number), pb=b.split('.').map(Number);
    for(let i=0;i<Math.max(pa.length,pb.length);i++){ const na=pa[i]||0, nb=pb[i]||0; if(na>nb) return 1; if(na<nb) return -1 }
    return 0;
  }

  function showUpdate(latest, downloadURL){
    document.getElementById('bootTitle').textContent = 'Update Required';
    document.getElementById('bootMsg').innerHTML = `Your version <code>${CURRENT_VERSION}</code> is outdated. Latest: <code>${latest}</code>. This build is locked until updated.`;
    const actions = document.getElementById('bootActions');
    actions.innerHTML = `<a class='button' href='${downloadURL || '#'}' target='_blank' rel='noopener'>Download Latest</a>`;
  }

  function showError(msg){
    document.getElementById('bootTitle').textContent = 'Version Check Failed';
    document.getElementById('bootMsg').textContent = msg || 'Cannot reach update server. Internet is required.';
    document.getElementById('bootActions').innerHTML = `<a class='button' href='#' onclick='bootSequence();return false;'>Retry</a>`;
  }

  // Injects the full app HTML+JS after successful version check
  function injectApp(appHtml, appScript){
    document.open();
    document.write(appHtml);
    document.close();
    const s = document.createElement('script'); s.type='module'; s.textContent = appScript; document.body.appendChild(s);
  }

  // ================= Readable APP Source (will be embedded) =================
  const APP_HTML = `
  <!doctype html>
  <html>
  <head>
  <meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>Advanced Game Hub</title>
  <style>
  :root{--bg:#071018;--panel:#0d1720;--muted:#9aa4b2;--accent:#39c0ff}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#031018);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6eef6}
  .app{display:grid;grid-template-columns:260px 1fr;gap:18px;height:100vh;padding:18px}
  .sidebar{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);border-radius:12px;padding:14px}
  .brand{font-weight:700;margin-bottom:12px}
  .game-item{padding:10px;border-radius:8px;margin-bottom:8px;cursor:pointer}
  .game-item:hover{background:rgba(255,255,255,0.02)}
  .controls{display:flex;gap:8px;margin-bottom:12px}
  .btn{background:var(--accent);color:#021014;padding:8px 10px;border-radius:8px;text-decoration:none;font-weight:600}
  .main{background:transparent;border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
  .iframe-wrap{flex:1;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
  iframe{width:100%;height:100%;border:0}
  .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .inputs{display:flex;gap:8px}
  input,select{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:inherit;padding:8px;border-radius:8px}
  .muted{color:var(--muted);font-size:13px}
  </style>
  </head>
  <body>
  <div class=\"app\">
    <div class=\"sidebar\">
      <div class=\"brand\">Game Hub <span class=\"muted\">v${CURRENT_VERSION}</span></div>
      <div class=\"controls\">
        <button id=\"addBtn\" class=\"btn\">Add</button>
        <button id=\"favBtn\" class=\"btn\">Favorites</button>
      </div>
      <div id=\"gameList\"></div>
      <hr style=\"border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0\">
      <div class=\"muted\">Tips: Add games using URLs that allow embedding (iframe).</div>
    </div>

    <div class=\"main\">
      <div class=\"topbar\">
        <div class=\"inputs\">
          <input id=\"urlInput\" placeholder=\"Custom iframe URL\" style=\"min-width:360px\"> 
          <input id=\"titleInput\" placeholder=\"Page title\" style=\"width:180px\">
          <input id=\"iconInput\" placeholder=\"Favicon URL\" style=\"width:180px\">
          <button id=\"loadBtn\" class=\"btn\">Load</button>
        </div>
        <div class=\"muted\">Status: <span id=\"status\">Ready</span></div>
      </div>

      <div class=\"iframe-wrap\">
        <iframe id=\"viewer\" srcdoc=\"<p style=\\"color:#9aa4b2;padding:20px;\\">No game loaded.</p>\"></iframe>
      </div>
    </div>
  </div>

  <script>
  // App logic (readable)
  const STORAGE_KEY = 'gamehub_v1';
  const ENCODED_LIST = 'W3sibmFtZSI6IkRlbW8gR2FtZSIsInVybCI6Imh0dHBzOi8vZGVtb2dhbWUuZXhhbXBsZS8ifSx7Im5hbWUiOiJTY2hvb3QifV0='; // base64 of sample list

  function b64Decode(str){ try{ return decodeURIComponent(atob(str).split('').map(c=>('%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))).join('')); }catch(e){ return atob(str);} }
  function loadGameList(){
    const raw = localStorage.getItem(STORAGE_KEY+'_list') || b64Decode(ENCODED_LIST);
    try{ return JSON.parse(raw);}catch(e){ return [] }
  }

  function saveGameList(list){ localStorage.setItem(STORAGE_KEY+'_list', JSON.stringify(list)); }

  function renderList(){
    const list = loadGameList();
    const container = document.getElementById('gameList'); container.innerHTML='';
    list.forEach((g, i)=>{
      const el = document.createElement('div'); el.className='game-item'; el.textContent = g.name; el.onclick = ()=>loadIntoIframe(g.url, g.name, g.icon); container.appendChild(el);
    });
  }

  function loadIntoIframe(url, title, icon){
    const iframe = document.getElementById('viewer');
    // Use srcdoc sandboxed wrapper to hide direct src and avoid leak
    const safeHtml = `<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self' ${new URL(url).origin} data: blob:; frame-ancestors 'none';\"><iframe src=\"${url}\" style=\"width:100%;height:100%;border:0;\"></iframe>`;
    iframe.srcdoc = safeHtml;
    if(title) document.title = title;
    if(icon) setFavicon(icon);
    document.getElementById('status').textContent = 'Loaded: '+ (title||url);
    // Save last opened
    localStorage.setItem(STORAGE_KEY+'_last', JSON.stringify({url, title, icon, t:Date.now()}));
  }

  function setFavicon(u){ let l = document.querySelector('link[rel="icon"]'); if(!l){ l=document.createElement('link'); l.rel='icon'; document.head.appendChild(l);} l.href = u; }

  document.getElementById('loadBtn').onclick = ()=>{
    const url = document.getElementById('urlInput').value.trim();
    const title = document.getElementById('titleInput').value.trim();
    const icon = document.getElementById('iconInput').value.trim();
    if(!url) return alert('Enter a URL');
    loadIntoIframe(url, title, icon);
  }

  document.getElementById('addBtn').onclick = ()=>{
    const name = prompt('Game name:'); if(!name) return; const url = prompt('Game URL (must allow embedding):'); if(!url) return; const list = loadGameList(); list.push({name, url}); saveGameList(list); renderList();
  }

  document.getElementById('favBtn').onclick = ()=>{
    const last = localStorage.getItem(STORAGE_KEY+'_last'); if(!last) return alert('No last opened'); const list = loadGameList(); list.unshift(JSON.parse(last)); saveGameList(list); renderList();
  }

  // Initialize
  renderList();
  const last = localStorage.getItem(STORAGE_KEY+'_last'); if(last){ try{ const l=JSON.parse(last); loadIntoIframe(l.url,l.title,l.icon);}catch(e){} }

  // Basic anti-inspect measures (obfuscation can't fully prevent viewing source)
  document.addEventListener('contextmenu', e=>e.preventDefault());
  document.addEventListener('keydown', e=>{ if(e.key==='F12' || (e.ctrlKey && e.shiftKey && (e.key==='I' || e.key==='J')) || (e.ctrlKey && e.key==='U')){ e.preventDefault(); } });
  </script>
  </body>
  </html>
  `;

  // The app script is the same as above but we'll keep it as a string to inject
  const APP_SCRIPT = '';

  // ================= End of embedded app source =================

  // For release builds we will minify/obfuscate the payload. For now we embed the readable source directly.
  async function bootSequence(){
    try{
      const resp = await fetch(VERSION_JSON_URL, {cache: 'no-store'});
      if(!resp.ok) throw new Error('Bad response');
      const data = await resp.json();
      const latest = data.latestVersion || data.version || data.latest || '';
      const downloadURL = data.downloadURL || '';
      if(!latest){ showError('Update manifest invalid.'); return; }
      const cmp = compareVersions(latest, CURRENT_VERSION);
      if(cmp === 1){
        showUpdate(latest, downloadURL);
      } else {
        // up to date or local newer -> inject readable app
        injectApp(APP_HTML, APP_SCRIPT);
      }
    }catch(err){
      console.error(err);
      showError('Unable to check updates. Make sure you are online.');
    }
  }

  bootSequence();
  </script>

  <!--
  Below are the two builds available in this document (copy them from the canvas):
  1) readable.html - the clean, commented, editable source above.
  2) minified.html - a compact, obfuscated single-file build for release (not included inline here; it's in the document sections below).
  -->

  <h2 style="display:none">Builds</h2>
  <pre style="display:none">-- readable.html and minified.html are included in this canvas document for you to copy.</pre>
</body>
</html>
